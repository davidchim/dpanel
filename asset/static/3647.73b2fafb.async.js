!(function(){var Tt=Object.defineProperty,Pt=Object.defineProperties;var jt=Object.getOwnPropertyDescriptors;var dt=Object.getOwnPropertySymbols;var wt=Object.prototype.hasOwnProperty,xt=Object.prototype.propertyIsEnumerable;var ut=(le,F,e)=>F in le?Tt(le,F,{enumerable:!0,configurable:!0,writable:!0,value:e}):le[F]=e,ct=(le,F)=>{for(var e in F||(F={}))wt.call(F,e)&&ut(le,e,F[e]);if(dt)for(var e of dt(F))xt.call(F,e)&&ut(le,e,F[e]);return le},ht=(le,F)=>Pt(le,jt(F));(self.webpackChunk=self.webpackChunk||[]).push([[3647],{23430:function(le,F,e){"use strict";e.d(F,{Z:function(){return H}});var q=e(87462),o=e(67294),G={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"download",theme:"outlined"},v=G,f=e(84089),g=function(r,t){return o.createElement(f.Z,(0,q.Z)({},r,{ref:t,icon:v}))},A=o.forwardRef(g),H=A},1883:function(le,F,e){"use strict";var q=e(87462),o=e(67294),G=e(3936),v=e(84089),f=function(H,n){return o.createElement(v.Z,(0,q.Z)({},H,{ref:n,icon:G.Z}))},g=o.forwardRef(f);F.Z=g},81146:function(le,F,e){"use strict";var q=e(97857),o=e.n(q),G=e(15009),v=e.n(G),f=e(99289),g=e.n(f),A=e(67294),H=e(97269),n=e(62370),r=e(5966),t=e(97462),s=e(82346),l=e(71230),h=e(15746),a=e(34041),D=e(83622),O=e(84567),L=e(42075),y=e(80821),ae=e(23430),re=e(93162),j=e.n(re),M=e(78267),_=e.n(M),m=e(75458),K=e.n(m),ge=e(12323),Ae=e(4244),p=e.n(Ae),qe=e(24078),be=e(36146),N=e(85893),oe,Oe,Se,ye={decorations:{matchBackground:"",matchBorder:"#FFFF00",activeMatchBackground:"#FFFF0066",matchOverviewRuler:"",activeMatchColorOverviewRuler:""}},Ke=(0,A.forwardRef)(function(je,Ne){var w=(0,A.useRef)(),b=(0,s.useModel)("subscriber"),B=new be.Uo("components.containerLog");(0,A.useImperativeHandle)(Ne,function(){return{fit:function(){oe.clear(),Se.fit()},start:function(){return g()(v()().mark(function Q(){return v()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,u({lineTotal:500});case 2:case"end":return i.stop()}},Q)}))()},close:function(){b.progress.close(je.id)}}});function u(J){return Qe.apply(this,arguments)}function Qe(){return Qe=g()(v()().mark(function J(Q){return v()().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:b.progress.close(je.id),oe.clear(),Q.download=!1,je.request(Q);case 4:case"end":return i.stop()}},J)})),Qe.apply(this,arguments)}return(0,A.useEffect)(function(){return window.addEventListener("resize",function(){Se.fit()}),oe=new Ae.Terminal(o()(o()({},ge.X),{},{fontSize:12,lineHeight:1.2,allowProposedApi:!0})),Se=new M.FitAddon,Oe=new m.SearchAddon({}),oe.loadAddon(Se),oe.loadAddon(Oe),oe.open(document.getElementById("terminal-container-log")),Se.fit(),b.addDataHandler(je.id,function(J){oe.write(J.data)}),function(){oe.clear(),oe.reset(),b.progress.close(je.id)}},[]),(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(H.A,{submitter:!1,layout:"horizontal",onFinish:function(Q){var C;u({id:je.id,lineTotal:parseInt(Q.lineTotal),showTime:(C=Q.showTime)!==null&&C!==void 0?C:!1})},formRef:w,children:(0,N.jsxs)(l.Z,{gutter:[10,0],children:[(0,N.jsx)(h.Z,{span:8,children:(0,N.jsx)(n.Z,{name:"lineTotal",initialValue:"500",label:B.format("formLineTotal"),children:(0,N.jsxs)(a.Z,{defaultValue:"500",onChange:function(Q){var C;(C=w.current)===null||C===void 0||C.submit()},children:[(0,N.jsx)(a.Z.Option,{value:"100",children:B.format("formLineTotalOption",{number:"100"})}),(0,N.jsx)(a.Z.Option,{value:"200",children:B.format("formLineTotalOption",{number:"200"})}),(0,N.jsx)(a.Z.Option,{value:"500",children:B.format("formLineTotalOption",{number:"500"})}),(0,N.jsx)(a.Z.Option,{value:"1000",children:B.format("formLineTotalOption",{number:"1000"})}),(0,N.jsx)(a.Z.Option,{value:"-1",children:B.format("formLineTotalOptionAll")})]})})}),(0,N.jsx)(h.Z,{children:(0,N.jsx)(D.ZP,{onClick:function(){oe.clear()},children:B.format("clearButton")})}),(0,N.jsx)(h.Z,{children:(0,N.jsx)(n.Z,{name:"showTime",valuePropName:"checked",children:(0,N.jsx)(O.Z,{onChange:function(Q){var C;(C=w.current)===null||C===void 0||C.submit()},children:B.format("formShowTime")})})}),(0,N.jsx)(h.Z,{children:(0,N.jsx)(r.Z,{label:B.format("formKeywork"),name:"keywork",fieldProps:{onPressEnter:function(){var Q;Oe.findNext((Q=w.current)===null||Q===void 0?void 0:Q.getFieldValue("keywork"),ye)},onChange:function(Q){Oe.findNext(Q.target.value,ye)}},placeholder:B.format("formKeyworkEmpty")})}),(0,N.jsx)(h.Z,{children:(0,N.jsx)(t.Z,{name:["keywork"],children:function(Q){var C=Q.keywork;return(0,N.jsxs)(L.Z,{size:10,children:[(0,N.jsx)(D.ZP,{onClick:function(){Oe.findNext(C,ye)},children:B.format("formKeyworkNext")},"next"),(0,N.jsx)(D.ZP,{onClick:function(){Oe.findPrevious(C,ye)},children:B.format("formKeyworkPrev")},"prev")]})}})}),(0,N.jsx)(h.Z,{children:(0,N.jsx)(y.Z,{icon:(0,N.jsx)(ae.Z,{}),action:g()(v()().mark(function J(){var Q,C,i;return v()().wrap(function(De){for(;;)switch(De.prev=De.next){case 0:if(!je.download){De.next=5;break}return De.next=3,je.download({lineTotal:parseInt((Q=w.current)===null||Q===void 0?void 0:Q.getFieldValue("lineTotal")),showTime:(C=w.current)===null||C===void 0?void 0:C.getFieldValue("showTime")});case 3:i=De.sent,(0,re.saveAs)(i.data,i.name);case 5:case"end":return De.stop()}},J)})),children:B.format("downloadButton")})})]})}),(0,N.jsx)("div",{style:{marginTop:"20px",height:je.showInDrawer?"75vh":"85vh"},id:"terminal-container-log"})]})});F.Z=Ke},37413:function(le,F,e){"use strict";e.d(F,{Z:function(){return h}});var q=e(19632),o=e.n(q),G=e(36146),v=e(85577),f=e(58638),g=e(36693),A=e(35995),H=e(99611),n=e(38345),r=e(42075),t=e(66309),s=e(55241),l=e(85893);function h(a){var D,O=new G.Uo("components.containerPort"),L=[];a.publicPort&&(L=o()(a.publicPort)),a.privatePort&&(L=[].concat(o()(L),o()(a.privatePort)));var y=(D=a.serverIp)!==null&&D!==void 0?D:"localhost";if(y!=""&&y.indexOf("http")===-1&&y.indexOf(":")>-1&&(y="[".concat(y,"]")),y==""||y=="127.0.0.1"){var ae=document.location.protocol+"//"+document.location.hostname;y=ae}var re=(0,l.jsxs)(n.Z,{direction:a.layout=="inline"?"row":"column",style:{width:a.layout!="inline"?600:"auto"},ghost:!0,children:[L.length>0&&(0,l.jsx)(n.Z,{title:(0,l.jsx)(v.Z,{}),subTitle:O.format("cardPortTitle"),ghost:a.ghost,bodyStyle:{maxHeight:300,overflow:"auto",margin:"10px 0"},children:L.map(function(j,M){var _;return y==""&&j.IP&&(y=j.IP),(0,l.jsx)(r.Z,{size:"large",wrap:!0,children:(0,l.jsx)(t.Z,{color:j.PublicPort?"blue":"yellow",icon:j.PublicPort?(0,l.jsx)(f.Z,{}):"",style:{marginBottom:10,marginRight:15},children:j.PublicPort?(0,l.jsx)("a",{href:"".concat(y.indexOf("http")===0?y:"http://"+y,":").concat(j.PublicPort),target:"_blank",children:"".concat(j.PublicPort?((_=j.IP)!==null&&_!==void 0?_:"0.0.0.0")+":"+j.PublicPort+" -> ":"").concat(j.PrivatePort,"/").concat(j.Type)},"link".concat(M)):"".concat(j.PrivatePort,"/").concat(j.Type)})},"space".concat(M))})}),a.domain&&a.domain.length>0&&(0,l.jsx)(n.Z,{title:(0,l.jsx)(g.Z,{}),subTitle:O.format("cardDomainTitle"),ghost:a.ghost,children:(0,l.jsx)(r.Z,{wrap:!0,style:{textAlign:"left"},children:a.domain&&a.domain.map(function(j,M){return(0,l.jsx)(t.Z,{color:"blue",icon:(0,l.jsx)(f.Z,{}),children:(0,l.jsx)("a",{href:j,target:"_blank",children:j})},"domain".concat(M))})})})]});return a.showInDetail?re:(0,l.jsx)(s.Z,{placement:"right",content:re,children:(0,l.jsxs)(r.Z,{direction:"vertical",children:[a.privatePort&&a.privatePort.length>0&&(0,l.jsxs)(t.Z,{color:"yellow",icon:(0,l.jsx)(A.Z,{}),children:[O.format("portPrivate"),": ",a.privatePort.length]}),a.publicPort&&a.publicPort.length>0&&(0,l.jsxs)(t.Z,{color:"blue",icon:(0,l.jsx)(H.Z,{}),children:[O.format("protPublic"),": ",a.publicPort.length]}),a.domain&&a.domain.length>0&&(0,l.jsx)(t.Z,{color:"geekblue",icon:(0,l.jsx)(g.Z,{}),children:a.domainTitle?a.domainTitle:"".concat(O.format("domain"),": ").concat(a.domain.length)})]})})}},94359:function(le,F,e){"use strict";e.d(F,{Z:function(){return D}});var q=e(5574),o=e.n(q),G=e(3089),v=e(98165),f=e(18429),g=e(8751),A=e(66212),H=e(14313),n=e(30159),r=e(87740),t=e(50888),s=e(66309),l=e(83062),h=e(36146),a=e(85893);function D(O){var L,y,ae=new h.Uo("components.containerStatus"),re=O.status.split("."),j=o()(re,2),M=j[0],_=j[1],m="";m=ae.format(O.status,(L=O.statusValue)!==null&&L!==void 0?L:{});var K=(0,a.jsx)(a.Fragment,{});return _=="0"&&(K=(0,a.jsx)(s.Z,{icon:(0,a.jsx)(G.Z,{}),color:"default",children:m})),_=="10"&&(K=(0,a.jsx)(s.Z,{icon:(0,a.jsx)(v.Z,{spin:!0}),color:"processing",children:m})),_=="20"&&(K=(0,a.jsx)(s.Z,{icon:(0,a.jsx)(f.Z,{}),color:"error",children:m})),_=="30"&&(K=(0,a.jsx)(s.Z,{icon:(0,a.jsx)(g.Z,{}),color:"success",children:m})),_=="new"&&(K=(0,a.jsx)(s.Z,{icon:(0,a.jsx)(A.Z,{}),children:m})),(_=="running"||_=="healthy"||_=="active"||_=="ready")&&(K=(0,a.jsx)(s.Z,{icon:(0,a.jsx)(H.Z,{}),color:"success",children:m})),(_=="paused"||_=="pause"||_=="rollback_paused")&&(K=(0,a.jsx)(s.Z,{icon:(0,a.jsx)(n.Z,{}),color:"warning",children:m})),(_=="waiting"||_=="starting"||_=="accepted")&&(K=(0,a.jsx)(s.Z,{icon:(0,a.jsx)(r.Z,{}),children:m})),["deploying","pending","allocated","accepted","assigned","preparing","updating","rollback_started"].includes(_)&&(K=(0,a.jsx)(s.Z,{icon:(0,a.jsx)(t.Z,{}),color:"processing",children:m})),(_=="error"||_=="down"||_=="failed")&&(K=(0,a.jsx)(s.Z,{icon:(0,a.jsx)(f.Z,{}),color:"error",children:m})),["complete","completed","rollback_completed"].includes(_)&&(K=(0,a.jsx)(s.Z,{icon:(0,a.jsx)(g.Z,{}),color:"success",children:m})),["exited","dead","removing","restarting","unhealthy","created","drain","unreachable","shutdown","rejected","remove","orphaned"].includes(_)&&(K=(0,a.jsx)(s.Z,{icon:(0,a.jsx)(f.Z,{}),color:"warning",children:m})),(0,a.jsx)(l.Z,{placement:"top",title:(y=O.tip)!==null&&y!==void 0?y:"",children:K})}},98093:function(le,F,e){"use strict";e.d(F,{Z:function(){return Q}});var q=e(15009),o=e.n(q),G=e(99289),v=e.n(G),f=e(5574),g=e.n(f),A=e(3616),H=e(184),n=e(62370),r=e(83622),t=e(67294),s=e(59252),l=e(24796),h=e(93529),a=e(91058),D=e(82034),O=e(10523),L=e(52255),y=e(38345),ae=e(5966),re=e(24739),j=e(30291),M=e(92398),_=e(36146),m=e(42963),K=e(42075),ge=e(64317),Ae=e(75870),p=e(85893);function qe(){var C=new _.Uo("components.appForm");return(0,p.jsxs)(K.Z.Compact,{children:[(0,p.jsx)(ge.Z,{name:"imageRegistry",width:"sm",fieldProps:{popupMatchSelectWidth:!1},request:v()(o()().mark(function i(){var Ie;return o()().wrap(function(he){for(;;)switch(he.prev=he.next){case 0:return he.next=2,(0,Ae.Ot)();case 2:return Ie=he.sent,he.abrupt("return",Ie.data.list.map(function(Ue){return{label:"".concat(Ue.title,"@").concat(Ue.serverAddress),value:Ue.id}}));case 4:case"end":return he.stop()}},i)})),label:C.format("dockerImageImageName")}),(0,p.jsx)(ae.Z,{label:" ",name:"imageName",required:!0,rules:[{required:!0}],width:"lg"})]})}var be=e(86615),N=e(97462),oe=e(31199),Oe=e(86250),Se=e(44349),ye=e(24494);function Ke(){var C,i=new _.Uo("components.appForm"),Ie=(0,t.useContext)(m.Z),De=Ie.createFormRef,he=(0,t.useRef)();return(0,p.jsxs)(y.Z,{children:[(0,p.jsxs)(Oe.Z,{gap:60,children:[(0,p.jsx)(be.Z.Group,{width:"md",label:i.format("createSchedulingLabel"),name:["scheduling","mode"],options:i.option("createSchedulingOption",["global","replicated"]),initialValue:"replicated",disabled:(C=De.current)===null||C===void 0?void 0:C.getFieldValue("id")}),(0,p.jsx)(N.Z,{name:["scheduling"],children:function(ke){var We=ke.scheduling;return We.mode=="replicated"&&(0,p.jsx)(oe.Z,{width:"md",label:i.format("createSchedulingReplicas"),name:["scheduling","replicas"],initialValue:1})}})]}),(0,p.jsx)(N.Z,{name:["scheduling","constraint"],children:function(ke){var We=ke.scheduling,$e=ke.constraint;return We.mode=="replicated"&&[(0,p.jsx)(be.Z.Group,{label:i.format("createConstraintNode"),initialValue:"all",name:["constraint","role"],options:i.option("createConstraintNodeOption",["all","manager","worker","user"])},"role"),$e&&$e.role=="user"&&(0,p.jsx)(ge.Z,{name:["constraint","node"],request:v()(o()().mark(function Ge(){var Ve;return o()().wrap(function(ie){for(;;)switch(ie.prev=ie.next){case 0:return ie.next=2,(0,ye.HN)();case 2:return Ve=ie.sent,ie.abrupt("return",Ve.data.list&&Ve.data.list.map(function(ue){var ve;return{label:(ve=ue.Description)===null||ve===void 0?void 0:ve.Hostname,value:ue.ID}}));case 4:case"end":return ie.stop()}},Ge)}))}),(0,p.jsx)(Se.Z,{name:["constraint","label"],label:i.format("createConstraintLabel"),hideCopyButton:!0,showAddButton:!0,gap:10,ref:he,items:[{label:i.format("createConstraintLabelOption.name"),name:"name",width:"md",placeholder:"node.labels.name"},{name:"operator",render:function(Ve,z,ie){return(0,p.jsx)(ge.Z,{label:" ",name:"operator",valueEnum:{"==":"==","!=":"!="},initialValue:"=="})}},{label:i.format("createConstraintLabelOption.value"),name:"value",width:"md"}]},"label"),(0,p.jsx)(Se.Z,{name:"placement",label:i.format("createPlacementLabel"),hideCopyButton:!0,showAddButton:!0,gap:10,items:[{name:"name",render:function(Ve,z,ie){return(0,p.jsx)(ge.Z,{label:" ",name:"type",options:i.option("createPlacementOption",["spread"]),initialValue:"spread",allowClear:!1,width:"sm"})}},{label:i.format("createConstraintLabelOption.value"),name:"value",width:"md",placeholder:"node.labels.hostname"}]},"placement")]}})]})}var je=e(73396),Ne=e(55730),w=e(33879);function b(){var C=new _.Uo("components.appForm");return(0,p.jsx)(y.Z,{children:(0,p.jsxs)(Oe.Z,{gap:30,children:[(0,p.jsx)(ge.Z,{label:C.format("createAdvRestart"),name:["restart","name"],width:"sm",initialValue:"any",options:C.option("createAdvRestartOption",["none","on-failure","any"])}),(0,p.jsx)(N.Z,{name:["restart"],children:function(Ie){var De=Ie.restart;return De=="on-failure"&&(0,p.jsx)(oe.Z,{width:"sm",label:C.format("createAdvRestartMax"),name:["restart","maxAttempt"],initialValue:5})}}),(0,p.jsx)(oe.Z,{width:"sm",label:C.format("createAdvRestartDelay"),tooltip:C.format("createAdvRestartDelayTip"),name:["restart","delay"],initialValue:5,fieldProps:{addonAfter:_.FD.format("unitSecond")}}),(0,p.jsx)(oe.Z,{width:"sm",label:C.format("createAdvRestartWindow"),tooltip:C.format("createAdvRestartWindowTip"),name:["restart","window"],initialValue:0,fieldProps:{addonAfter:_.FD.format("unitSecond")}})]})})}function B(){var C=new _.Uo("components.appForm");return(0,p.jsxs)(y.Z,{children:[(0,p.jsxs)(Oe.Z,{gap:30,children:[(0,p.jsx)(oe.Z,{label:C.format("createSwarmUpdateParallelism"),name:["scheduling","update","parallelism"],initialValue:1}),(0,p.jsx)(oe.Z,{label:C.format("createSwarmUpdateDelay"),name:["scheduling","update","delay"],initialValue:0,fieldProps:{addonAfter:_.FD.format("unitSecond")}})]}),(0,p.jsx)(be.Z.Group,{label:C.format("createSwarmUpdateFailureAction"),name:["scheduling","update","failureAction"],initialValue:"pause",options:C.option("createSwarmUpdateFailureActionOption",["pause","continue","rollback"])}),(0,p.jsx)(be.Z.Group,{label:C.format("createSwarmUpdateOrder"),name:["scheduling","update","order"],initialValue:"stop-first",options:C.option("createSwarmUpdateOrderOption",["stop-first","start-first"])})]})}var u=e(64412),Qe=e(27323),J=(0,t.forwardRef)(function(C,i){(0,t.useImperativeHandle)(i,function(){return{edit:function(P){var S,U,E,x,X,W,Y,Z,I,Te,ee,ce,pe,c,xe,me,Ze,Ee,Ye,Ce,Re,Le,Me,$,T,R,te,k,ne,Pe,_e,Fe,et,Xe,rt,at={id:P.ID,siteName:(S=(U=P.Spec)===null||U===void 0?void 0:U.Name)!==null&&S!==void 0?S:"",siteTitle:((E=P.Spec)===null||E===void 0?void 0:E.Labels)&&((x=P.Spec)===null||x===void 0?void 0:x.Labels[ye.$m]),hostname:(X=P.Spec)===null||X===void 0||(X=X.TaskTemplate)===null||X===void 0||(X=X.ContainerSpec)===null||X===void 0?void 0:X.Hostname,imageName:(W=(Y=P.Spec)===null||Y===void 0||(Y=Y.TaskTemplate)===null||Y===void 0||(Y=Y.ContainerSpec)===null||Y===void 0?void 0:Y.Image)!==null&&W!==void 0?W:"",environment:(Z=P.Spec)===null||Z===void 0||(Z=Z.TaskTemplate)===null||Z===void 0||(Z=Z.ContainerSpec)===null||Z===void 0||(Z=Z.Env)===null||Z===void 0?void 0:Z.map(function(d){var V=d.split("=");return{name:V[0],value:V.slice(1).join("=")}}),volumes:(I=P.Spec)===null||I===void 0||(I=I.TaskTemplate)===null||I===void 0||(I=I.ContainerSpec)===null||I===void 0||(I=I.Mounts)===null||I===void 0?void 0:I.map(function(d){var V,de;return{dest:(V=d.Target)!==null&&V!==void 0?V:"",host:(de=d.Source)!==null&&de!==void 0?de:"",type:d.Type,permission:d.ReadOnly?"readonly":"write"}}),restartPolicy:function(d,V){return{name:(V=d.Condition)!==null&&V!==void 0?V:"any",maxAttempt:d.MaxAttempts,window:d.Window,delay:d.Delay}}(((Te=P.Spec)===null||Te===void 0||(Te=Te.TaskTemplate)===null||Te===void 0?void 0:Te.RestartPolicy)||{}),cpus:function(d){return d?d/1e9:0}((ee=P.Spec)===null||ee===void 0||(ee=ee.TaskTemplate)===null||ee===void 0||(ee=ee.Resources)===null||ee===void 0||(ee=ee.Limits)===null||ee===void 0?void 0:ee.NanoCPUs),memory:function(d){return d?d/1024/1024:0}((ce=P.Spec)===null||ce===void 0||(ce=ce.TaskTemplate)===null||ce===void 0||(ce=ce.Resources)===null||ce===void 0||(ce=ce.Limits)===null||ce===void 0?void 0:ce.MemoryBytes),workDir:{useDefault:!((pe=P.Spec)!==null&&pe!==void 0&&(pe=pe.TaskTemplate)!==null&&pe!==void 0&&(pe=pe.ContainerSpec)!==null&&pe!==void 0&&pe.Dir),default:"",value:(c=P.Spec)===null||c===void 0||(c=c.TaskTemplate)===null||c===void 0||(c=c.ContainerSpec)===null||c===void 0?void 0:c.Dir},user:{useDefault:!((xe=P.Spec)!==null&&xe!==void 0&&(xe=xe.TaskTemplate)!==null&&xe!==void 0&&(xe=xe.ContainerSpec)!==null&&xe!==void 0&&xe.User),default:"",value:(me=P.Spec)===null||me===void 0||(me=me.TaskTemplate)===null||me===void 0||(me=me.ContainerSpec)===null||me===void 0?void 0:me.User},command:{useDefault:!((Ze=P.Spec)!==null&&Ze!==void 0&&(Ze=Ze.TaskTemplate)!==null&&Ze!==void 0&&(Ze=Ze.ContainerSpec)!==null&&Ze!==void 0&&Ze.Command),default:"",value:(Ee=P.Spec)===null||Ee===void 0||(Ee=Ee.TaskTemplate)===null||Ee===void 0||(Ee=Ee.ContainerSpec)===null||Ee===void 0||(Ee=Ee.Command)===null||Ee===void 0?void 0:Ee.join(" ")},log:function(d,V){return{driver:(V=d==null?void 0:d.Name)!==null&&V!==void 0?V:"json-file",maxFile:(d==null?void 0:d.Options)&&d.Options["max-file"],maxSize:(d==null?void 0:d.Options)&&d.Options["max-size"]}}((Ye=P.Spec)===null||Ye===void 0||(Ye=Ye.TaskTemplate)===null||Ye===void 0?void 0:Ye.LogDriver),dns:(Ce=P.Spec)===null||Ce===void 0||(Ce=Ce.TaskTemplate)===null||Ce===void 0||(Ce=Ce.ContainerSpec)===null||Ce===void 0||(Ce=Ce.DNSConfig)===null||Ce===void 0?void 0:Ce.Nameservers,label:((Re=P.Spec)===null||Re===void 0||(Re=Re.TaskTemplate)===null||Re===void 0||(Re=Re.ContainerSpec)===null||Re===void 0?void 0:Re.Labels)&&Object.entries((Le=P.Spec)===null||Le===void 0||(Le=Le.TaskTemplate)===null||Le===void 0||(Le=Le.ContainerSpec)===null||Le===void 0?void 0:Le.Labels).map(function(d){return{name:d[0],value:d[1]}}),extraHosts:((Me=P.Spec)===null||Me===void 0||(Me=Me.TaskTemplate)===null||Me===void 0||(Me=Me.ContainerSpec)===null||Me===void 0?void 0:Me.Hosts)&&(($=P.Spec)===null||$===void 0||($=$.TaskTemplate)===null||$===void 0||($=$.ContainerSpec)===null||$===void 0?void 0:$.Hosts.map(function(d){var V=d.split(":"),de=g()(V,2),He=de[0],Be=de[1];return{name:He,value:Be}})),capAdd:(T=P.Spec)===null||T===void 0||(T=T.TaskTemplate)===null||T===void 0||(T=T.ContainerSpec)===null||T===void 0?void 0:T.CapabilityAdd,scheduling:function(d){return{mode:d!=null&&d.Global?"global":"replicated",replicas:d!=null&&d.Replicated?d.Replicated.Replicas:1}}((R=P.Spec)===null||R===void 0?void 0:R.Mode),constraint:function(d,V,de,He){var Be="all";d!=null&&(V=d.Constraints)!==null&&V!==void 0&&V.includes("node.role==worker")&&(Be="worker"),d!=null&&(de=d.Constraints)!==null&&de!==void 0&&de.includes("node.role==manager")&&(Be="manager"),d==null||(He=d.Constraints)===null||He===void 0||He.forEach(function(Je){Je.includes("node.id==")&&(Be="user")});var tt="",nt=[];return d!=null&&d.Constraints&&d.Constraints.forEach(function(Je){if(Je.includes("node.id==")){var vt=Je.split("node.id=="),st=g()(vt,2),Et=st[0],mt=st[1];tt=mt;return}if(Je.includes("==")){var ft=Je.split("=="),lt=g()(ft,2),pt=lt[0],_t=lt[1];nt.push({name:pt,value:_t,operator:"=="});return}if(Je.includes("!=")){var gt=Je.split("!="),ot=g()(gt,2),St=ot[0],Dt=ot[1];nt.push({name:St,value:Dt,operator:"!="});return}}),{role:Be,node:tt,label:nt}}((te=P.Spec)===null||te===void 0||(te=te.TaskTemplate)===null||te===void 0?void 0:te.Placement),placement:((k=P.Spec)===null||k===void 0||(k=k.TaskTemplate)===null||k===void 0||(k=k.Placement)===null||k===void 0?void 0:k.Preferences)&&Object.entries((ne=P.Spec)===null||ne===void 0||(ne=ne.TaskTemplate)===null||ne===void 0||(ne=ne.Placement)===null||ne===void 0?void 0:ne.Preferences).map(function(d){var V,de;return{name:"spread",value:(V=(de=d[1].Spread)===null||de===void 0?void 0:de.SpreadDescriptor)!==null&&V!==void 0?V:""}}),update:function(d,V,de){return{parallelism:(V=d==null?void 0:d.Parallelism)!==null&&V!==void 0?V:1,delay:(de=d==null?void 0:d.Delay)!==null&&de!==void 0?de:0,failureAction:d==null?void 0:d.FailureAction,order:d==null?void 0:d.Order}}((Pe=P.Spec)===null||Pe===void 0?void 0:Pe.UpdateConfig),healthcheck:function(d,V,de,He,Be,tt){var nt=d!=null&&(V=d.Test)!==null&&V!==void 0&&V.includes("CMD-SHELL")?"CMD-SHELL":"CMD";return{interval:(de=d==null?void 0:d.Interval)!==null&&de!==void 0?de:30,timeout:(He=d==null?void 0:d.Timeout)!==null&&He!==void 0?He:10,retries:(Be=d==null?void 0:d.Retries)!==null&&Be!==void 0?Be:3,cmd:d!=null&&d.Test?d==null||(tt=d.Test)===null||tt===void 0?void 0:tt.join(" "):"",shellType:nt}}((_e=P.Spec)===null||_e===void 0||(_e=_e.TaskTemplate)===null||_e===void 0||(_e=_e.ContainerSpec)===null||_e===void 0?void 0:_e.Healthcheck)},it=((Fe=P.Spec)===null||Fe===void 0?void 0:Fe.Labels)&&((et=P.Spec)===null||et===void 0?void 0:et.Labels[ye.ev]);if(it&&(at.imageRegistry=parseInt(it)),(Xe=P.Spec)!==null&&Xe!==void 0&&(Xe=Xe.EndpointSpec)!==null&&Xe!==void 0&&Xe.Ports){var ze;at.ports=(ze=P.Spec)===null||ze===void 0||(ze=ze.EndpointSpec)===null||ze===void 0||(ze=ze.Ports)===null||ze===void 0?void 0:ze.map(function(d){var V;return{dest:String(d.TargetPort),host:String((V=d.PublishedPort)!==null&&V!==void 0?V:""),mode:d.PublishMode}})}(rt=$e.current)===null||rt===void 0||rt.setFieldsValue(at),fe(!0)}}});var Ie=(0,t.useState)("basic"),De=g()(Ie,2),he=De[0],Ue=De[1],ke=new _.Uo("components.appForm"),We=new _.Uo("swarm"),$e=(0,t.useRef)(),Ge=(0,t.useRef)(),Ve=(0,t.useRef)(),z=(0,t.useRef)(),ie=(0,t.useRef)(),ue=(0,t.useState)(!1),ve=g()(ue,2),we=ve[0],fe=ve[1];return(0,p.jsx)(m.Z.Provider,{value:{createFormRef:$e,volumeListRef:Ge,createEnvRef:ie,createLinkRef:z,domainRef:Ve},children:(0,p.jsx)(H.a,{drawerProps:{width:A.R_,forceRender:C.forceRender},formRef:$e,title:We.format("serviceCreateTitle.".concat(C.forceRender?"edit":"create")),onOpenChange:function(P){if(fe(P),!P){var S,U;!((S=$e.current)===null||S===void 0)&&S.resetFields&&((U=$e.current)===null||U===void 0||U.resetFields()),Ue("basic")}},open:we,trigger:C.showTrigger?(0,p.jsx)(r.ZP,{type:"primary",children:We.format("serviceCreateTitle.create")}):void 0,onFinish:function(){var se=v()(o()().mark(function P(S){var U,E,x;return o()().wrap(function(W){for(;;)switch(W.prev=W.next){case 0:return E={id:S.id,siteTitle:S.siteTitle,siteName:S.siteName,hostname:S.hostname,imageRegistry:S.imageRegistry,imageName:S.imageName,ports:S.ports,environment:S.environment,volumes:S.volumes,restartPolicy:S.restart,cpus:S.cpus,memory:S.memory,workDir:S.workDir&&!S.workDir.useDefault?S.workDir.value:"",user:S.user&&!S.user.useDefault?S.user.value:"",command:S.command&&!S.command.useDefault?S.command.value:"",entrypoint:S.entrypoint&&!S.entrypoint.useDefault?S.entrypoint.value:"",log:S.log,dns:S.dns,label:S.label,extraHosts:S.extraHosts,capAdd:S.capAdd,scheduling:S.scheduling,constraint:S.constraint,placement:S.placement,update:S.update},S.healthcheck&&S.healthcheck.cmd&&S.healthcheck.cmd!=""&&(E.healthcheck=S.healthcheck),E.scheduling&&((U=E.scheduling)===null||U===void 0?void 0:U.mode)=="global"&&E.ports&&(E.ports=(x=E.ports)===null||x===void 0?void 0:x.map(function(Y){return Y.mode="host",Y})),W.next=5,(0,ye.P3)(E);case 5:return C.onFinish&&C.onFinish(),W.abrupt("return",!0);case 7:case"end":return W.stop()}},P)}));return function(P){return se.apply(this,arguments)}}(),children:(0,p.jsxs)(y.Z,{direction:"column",gutter:[0,10],ghost:!0,children:[(0,p.jsxs)(y.Z,{children:[(0,p.jsx)(n.Z,{name:"id",hidden:!0}),(0,p.jsx)(ae.Z,{name:"siteTitle",label:_.FD.format("listDescription"),placeholder:We.format("serviceCreateListDescriptionEmpty")}),(0,p.jsxs)(re.UW,{children:[(0,p.jsx)(ae.Z,{width:"lg",name:"siteName",label:_.FD.format("listName"),required:!0,rules:[{required:!0}],placeholder:We.format("serviceCreateListNameEmpty")}),(0,p.jsx)(ae.Z,{label:"Hostname",name:"hostname",width:"md"})]}),(0,p.jsx)(qe,{})]}),(0,p.jsx)(j.Z,{offsetTop:50,children:(0,p.jsx)(y.Z,{style:{marginBottom:-20},children:(0,p.jsx)(M.Z,{activeKey:he,onChange:function(P){Ue(P),window.scrollTo(0,450)},items:ke.option("createTabOption",["basic","scheduling","run-command","cap","other"]).map(function(se){return{label:se.label,key:se.value}})})})}),(0,p.jsxs)(L.Z,{show:he=="basic",children:[(0,p.jsx)(D.Z,{showIngress:!0}),(0,p.jsx)(a.Z,{showAddButton:!0,showImportButton:!0,showCodeMode:!0,label:ke.format("createEnvTitle"),ref:ie}),(0,p.jsx)(O.Z,{showDefault:!0,ref:Ge,showType:!0}),(0,p.jsx)(s.Z,{})]}),(0,p.jsxs)(L.Z,{show:he=="scheduling",children:[(0,p.jsx)(Ke,{}),(0,p.jsx)(B,{})]}),(0,p.jsxs)(L.Z,{show:he=="run-command",children:[(0,p.jsx)(b,{}),(0,p.jsx)(w.Z,{showCommand:!0,showUser:!0,showWorkDir:!0}),(0,p.jsx)(je.Z,{}),(0,p.jsx)(Ne.Z,{}),(0,p.jsx)(u.Z,{}),(0,p.jsx)(Qe.Z,{})]}),(0,p.jsx)(L.Z,{show:he=="other",children:(0,p.jsx)(l.Z,{})}),(0,p.jsx)(L.Z,{show:he=="cap",children:(0,p.jsx)(h.Z,{})})]})})})}),Q=J},94617:function(le,F,e){"use strict";e.d(F,{Z:function(){return Ve}});var q=e(15009),o=e.n(q),G=e(99289),v=e.n(G),f=e(97857),g=e.n(f),A=e(5574),H=e.n(A),n=e(24494),r=e(5251),t=e(36146),s=e(86548),l=e(1883),h=e(74763),a=e(56729),D=e(42075),O=e(66309),L=e(25593),y=e(96074),ae=e(83062),re=e(60940),j=e(37413),M=e(94359),_=e(67294),m=e(87662),K=e(78451),ge=e(3616),Ae=e(33160),p=e(43425),qe=e(57132),be=e(71965),N=e(48689),oe=e(45605),Oe=e(60433),Se=e(38345),ye=e(97269),Ke=e(24739),je=e(31199),Ne=e(62370),w=e(64317),b=e(85265),B=e(86250),u=e(83622),Qe=e(84567),J=e(26412),Q=e(80821),C=e(76428),i=e(85893);function Ie(z){var ie,ue,ve=new t.Uo("swarm"),we=z.detail;if((ie=we.Spec)!==null&&ie!==void 0&&(ie=ie.Mode)!==null&&ie!==void 0&&ie.Replicated){var fe;return(0,i.jsxs)(D.Z,{children:[(0,i.jsx)(O.Z,{children:ve.format("listServiceMode.replicated")}),(0,i.jsx)(O.Z,{color:"success",bordered:!1,children:(fe=we.ServiceStatus)===null||fe===void 0?void 0:fe.RunningTasks}),(0,i.jsx)(O.Z,{color:"gold",bordered:!1,children:we.Spec.Mode.Replicated.Replicas})]})}else if((ue=we.Spec)!==null&&ue!==void 0&&(ue=ue.Mode)!==null&&ue!==void 0&&ue.Global)return(0,i.jsx)(O.Z,{children:ve.format("listServiceMode.global")})}var De=e(81146);function he(z){var ie=(0,_.useState)(!1),ue=H()(ie,2),ve=ue[0],we=ue[1],fe=(0,_.useRef)();return(0,i.jsxs)(i.Fragment,{children:[z.trigger?_.cloneElement(z.trigger,{onClick:function(){we(!0)}}):null,(0,i.jsx)(b.Z,{title:"".concat(t.FD.format("listLog")," - ").concat(z.detail.name),open:ve,forceRender:!0,onClose:function(){we(!1)},afterOpenChange:function(P){if(P)setTimeout(function(){var U,E;(U=fe.current)===null||U===void 0||U.start(),(E=fe.current)===null||E===void 0||E.fit()},1e3);else{var S;(S=fe.current)===null||S===void 0||S.close()}},width:ge.FK,children:ve&&(0,i.jsx)(De.Z,{ref:fe,showInDrawer:!0,id:"swarm:log:".concat(z.type,":").concat(z.detail.id),request:function(){var se=v()(o()().mark(function P(S){var U;return o()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,(0,n.m8)({id:z.detail.id,type:z.type,lineTotal:S.lineTotal,download:(U=S.download)!==null&&U!==void 0?U:!1,showTime:S.showTime});case 2:case"end":return x.stop()}},P)}));return function(P){return se.apply(this,arguments)}}(),download:function(){var se=v()(o()().mark(function P(S){var U;return o()().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,(0,n.Id)({id:z.detail.id,type:z.type,lineTotal:S.lineTotal,showTime:S.showTime,download:!0});case 2:return U=x.sent,x.abrupt("return",{data:new Blob([U],{type:"text/plain"}),name:z.detail.name+"_"+new Date().toLocaleDateString()+".log"});case 4:case"end":return x.stop()}},P)}));return function(P){return se.apply(this,arguments)}}()})})]})}var Ue=e(98093),ke=e(67255),We=(0,_.forwardRef)(function(z,ie){var ue,ve,we,fe,se,P,S,U,E,x,X,W,Y;(0,_.useImperativeHandle)(ie,function(){return{show:function(T){xe(T),ee(!0)}}});var Z=(0,_.useState)(!1),I=H()(Z,2),Te=I[0],ee=I[1],ce=(0,_.useState)(),pe=H()(ce,2),c=pe[0],xe=pe[1],me=new t.Uo("swarm"),Ze=(0,_.useState)(""),Ee=H()(Ze,2),Ye=Ee[0],Ce=Ee[1],Re=(0,_.useRef)(),Le=(0,_.useRef)(),Me=(0,_.useRef)();return(0,_.useEffect)(function(){(0,m.K3)().then(function($){var T;Ce((T=$.data.serverUrl)!==null&&T!==void 0?T:"")})},[]),(0,i.jsxs)(b.Z,{title:me.format("serviceDetailTitle",{name:c==null||(ue=c.Spec)===null||ue===void 0?void 0:ue.Name}),open:Te,forceRender:!0,width:ge.R_,onClose:function(){ee(!1),xe(void 0),z.onFinish&&z.onFinish()},extra:[c&&(0,i.jsx)(Q.Z,{type:"link",tips:t.FD.format("listManageRefresh"),action:v()(o()().mark(function $(){var T,R;return o()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.next=2,(0,n.ig)({id:c.ID});case 2:R=k.sent,xe(R.data.info),!((T=Me.current)===null||T===void 0)&&T.reloadAndRest&&Me.current.reloadAndRest();case 5:case"end":return k.stop()}},$)})),icon:(0,i.jsx)(Ae.Z,{})},"refresh")],children:[(0,i.jsx)(Ue.Z,{forceRender:!0,ref:Le,onFinish:v()(o()().mark(function $(){var T,R;return o()().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.next=2,(0,n.ig)({id:(T=c==null?void 0:c.ID)!==null&&T!==void 0?T:""});case 2:R=k.sent,xe(R.data.info);case 4:case"end":return k.stop()}},$)}))}),(0,i.jsxs)(B.Z,{vertical:!0,gap:20,children:[(0,i.jsx)(Se.Z,{title:(0,i.jsx)(p.Z,{}),ghost:!0,subTitle:t.FD.format("listManage"),children:(0,i.jsxs)(D.Z,{wrap:!0,children:[c&&(0,i.jsx)(u.ZP,{type:"primary",icon:(0,i.jsx)(s.Z,{}),onClick:function(){var T;(T=Le.current)===null||T===void 0||T.edit(c)},children:t.FD.format("listManageEdit")}),(0,i.jsx)(y.Z,{type:"vertical"}),c&&(0,i.jsx)(he,{type:"service",detail:{id:(ve=c.ID)!==null&&ve!==void 0?ve:"",name:(we=(fe=c.Spec)===null||fe===void 0?void 0:fe.Name)!==null&&we!==void 0?we:""},trigger:(0,i.jsx)(u.ZP,{icon:(0,i.jsx)(l.Z,{}),children:t.FD.format("listManageLog")},"log")}),(c==null||(se=c.Spec)===null||se===void 0||(se=se.Mode)===null||se===void 0?void 0:se.Replicated)&&(0,i.jsx)(Q.Z,{confirmProps:{forceRender:!0},action:v()(o()().mark(function $(){var T,R,te;return o()().wrap(function(ne){for(;;)switch(ne.prev=ne.next){case 0:return ne.abrupt("return",(0,n.x$)({name:(T=c==null?void 0:c.ID)!==null&&T!==void 0?T:"",replicas:(R=Re.current)===null||R===void 0?void 0:R.getFieldValue("replicas"),force:(te=Re.current)===null||te===void 0?void 0:te.getFieldValue("force")}));case 1:case"end":return ne.stop()}},$)})),confirmOnOpenChange:function(){var T,R;(T=Re.current)===null||T===void 0||T.setFieldsValue({replicas:(R=c.Spec)===null||R===void 0||(R=R.Mode)===null||R===void 0||(R=R.Replicated)===null||R===void 0?void 0:R.Replicas,force:!1})},confirm:(0,i.jsx)(ye.A,{layout:"inline",submitter:!1,formRef:Re,children:(0,i.jsxs)(D.Z,{direction:"vertical",size:[0,15],style:{width:600},children:[(0,i.jsx)(L.Z.Text,{children:me.format("serviceManageScalingTip")}),(0,i.jsxs)(Ke.UW,{children:[(0,i.jsx)(je.Z,{label:me.format("serviceManageScalingReplicas"),width:"sm",name:"replicas"}),(0,i.jsx)(Ne.Z,{name:"force",valuePropName:"checked",children:(0,i.jsxs)(Qe.Z,{children:[t.FD.format("listManageDeployForce"),"\uFF1F"]})})]})]})}),onSuccess:function(){(0,n.ig)({id:c.ID}).then(function(T){xe(T.data.info)})},icon:(0,i.jsx)(qe.Z,{}),children:t.FD.format("listManageScaling")}),c&&(0,i.jsx)(Q.Z,{action:function(){return(0,n.x$)({name:c.ID,rollback:!0})},icon:(0,i.jsx)(be.Z,{}),confirm:"notification.confirm.title",children:t.FD.format("listManageRollback")}),(0,i.jsx)(Q.Z,{showDivider:!0,action:function(){var T;return(0,n.tm)({name:[(T=c==null?void 0:c.ID)!==null&&T!==void 0?T:""]})},type:"primary",danger:!0,onSuccess:function(T){ee(!1),z.onFinish&&z.onFinish()},confirm:"notification.confirm.title",icon:(0,i.jsx)(N.Z,{}),children:t.FD.format("listManageDelete")})]})}),c&&(0,i.jsx)(j.Z,{publicPort:((P=c.Endpoint)===null||P===void 0?void 0:P.Ports)&&((S=c.Endpoint)===null||S===void 0?void 0:S.Ports.map(function($){var T,R,te;return{PrivatePort:(T=$.TargetPort)!==null&&T!==void 0?T:0,Type:(R=$.Protocol)!==null&&R!==void 0?R:"tcp",IP:"",PublicPort:(te=$.PublishedPort)!==null&&te!==void 0?te:0}})),serverIp:Ye,showInDetail:!0,ghost:!0,layout:"inline"}),(0,i.jsx)(Se.Z,{title:(0,i.jsx)(oe.Z,{}),subTitle:t.FD.format("listManageDetail"),ghost:!0,children:(0,i.jsxs)(J.Z,{column:1,bordered:!0,styles:{label:{width:150}},children:[(0,i.jsxs)(J.Z.Item,{label:t.FD.format("listTitle"),children:[(0,i.jsx)(C.Z,{title:c==null?void 0:c.ID})," - ",c==null||(U=c.Spec)===null||U===void 0?void 0:U.Name,c&&((E=c.UpdateStatus)===null||E===void 0?void 0:E.State)&&(0,i.jsxs)(i.Fragment,{children:[" - ",(0,i.jsx)(M.Z,{status:"service.".concat((x=c.UpdateStatus)===null||x===void 0?void 0:x.State)})]})]}),(0,i.jsx)(J.Z.Item,{label:t.FD.format("listDescription"),children:(c==null||(X=c.Spec)===null||X===void 0?void 0:X.Labels)&&c.Spec.Labels[n.$m]}),(0,i.jsx)(J.Z.Item,{label:t.FD.format("listRunTask"),children:(0,i.jsx)(D.Z,{children:(c==null?void 0:c.ServiceStatus)&&Object.keys(c.ServiceStatus).map(function($){var T=$;return(c==null?void 0:c.ServiceStatus)&&(0,i.jsx)(ae.Z,{title:me.format("listServiceStatusTip.".concat(T)),children:(0,i.jsxs)(O.Z,{color:me.format("listServiceStatusColor.".concat(T)),bordered:!1,children:[me.format("listServiceStatus.".concat(T))," ",c==null?void 0:c.ServiceStatus[T]]})},T)})})}),(0,i.jsx)(J.Z.Item,{label:t.FD.format("listServiceMode"),children:c&&(0,i.jsx)(Ie,{detail:c})}),(0,i.jsx)(J.Z.Item,{label:t.FD.format("listImageName"),children:c==null||(W=c.Spec)===null||W===void 0||(W=W.TaskTemplate)===null||W===void 0||(W=W.ContainerSpec)===null||W===void 0?void 0:W.Image}),(0,i.jsx)(J.Z.Item,{label:t.FD.format("listVersion"),children:c==null||(Y=c.Version)===null||Y===void 0?void 0:Y.Index}),(0,i.jsx)(J.Z.Item,{label:t.FD.format("listCreatedAt"),children:(0,r.NF)(c==null?void 0:c.CreatedAt)}),(0,i.jsx)(J.Z.Item,{label:t.FD.format("listUpdatedAt"),children:(0,r.NF)(c==null?void 0:c.UpdatedAt)})]})}),c&&(0,i.jsx)(Se.Z,{title:(0,i.jsx)(Oe.Z,{}),subTitle:me.format("listTaskTitle"),ghost:!0,children:(0,i.jsx)(a.Z,{scroll:{x:"max-content"},rowKey:"ID",search:{filterType:"light"},actionRef:Me,columns:[{search:!1,title:t.FD.format("listName"),render:function(T,R,te,k,ne){return R.ID}},{search:!1,width:200,title:t.FD.format("listNodeName"),render:function(T,R,te,k,ne){return R.NodeID}},{search:!1,width:50,title:t.FD.format("listSlot"),render:function(T,R,te,k,ne){return R.Slot}},{key:"status",renderFormItem:function(T,R,te,k){return(0,i.jsx)(w.Z,{name:"status",valueEnum:Object.fromEntries(me.option("listTaskStatusOption",["running","shutdown","accepted"]).map(function(ne){return[ne.value,ne.label]}))})},width:120,title:t.FD.format("listRunStatus"),render:function(T,R,te){var k;if(R.Status.State!="running"){var ne;return(0,i.jsx)(M.Z,{status:"task.".concat(R.Status.State),tip:(ne=R.Status.Err)!==null&&ne!==void 0?ne:R.Status.Message})}return(0,i.jsx)(M.Z,{status:"task.".concat(R.DesiredState),tip:(k=R.Status.Err)!==null&&k!==void 0?k:R.Status.Message})}},{search:!1,width:180,title:t.FD.format("listUpdatedAt"),render:function(T,R,te,k,ne){return(0,r.NF)(R.UpdatedAt)}},{search:!1,width:100,title:t.FD.format("listManage"),fixed:"right",render:function(T,R,te,k,ne){var Pe,_e;return(0,i.jsx)(D.Z,{children:(0,i.jsx)(he,{type:"node",detail:{id:(Pe=R.ID)!==null&&Pe!==void 0?Pe:"",name:(_e=R.ID)!==null&&_e!==void 0?_e:""},trigger:(0,i.jsx)(L.Z.Link,{children:(0,i.jsx)(l.Z,{})})})})}}],request:function(){var $=v()(o()().mark(function T(R){var te,k;return o()().wrap(function(Pe){for(;;)switch(Pe.prev=Pe.next){case 0:return Pe.next=2,(0,n.XX)({serviceName:c==null?void 0:c.ID,status:R.status});case 2:return te=Pe.sent,Pe.next=5,(0,n.HN)();case 5:return k=Pe.sent,Pe.abrupt("return",{data:te.data.list.map(function(_e){var Fe,et=k&&((Fe=k.data.list.find(function(Xe){return Xe.ID==_e.NodeID}))===null||Fe===void 0||(Fe=Fe.Description)===null||Fe===void 0?void 0:Fe.Hostname);return et&&(_e.NodeID=et),_e}),success:!0,total:te.data.list.length});case 7:case"end":return Pe.stop()}},T)}));return function(T){return $.apply(this,arguments)}}(),pagination:(0,ke.Oh)()})})]})]})}),$e=We,Ge=(0,_.forwardRef)(function(z,ie){(0,_.useImperativeHandle)(ie,function(){return{reload:function(){var E;!((E=P.current)===null||E===void 0)&&E.reloadAndRest&&P.current.reloadAndRest()}}});var ue=(0,_.useState)(""),ve=H()(ue,2),we=ve[0],fe=ve[1],se=(0,_.useRef)(),P=(0,_.useRef)();(0,_.useEffect)(function(){(0,m.K3)().then(function(U){var E;fe((E=U.data.serverUrl)!==null&&E!==void 0?E:"")})},[]);var S={};return z.showManage||(S=g()(g()({},S),{})),(0,h.k)(z.showSearch)&&(S=g()(g()({},S),{search:!1})),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)($e,{ref:se,onFinish:function(){var E;!((E=P.current)===null||E===void 0)&&E.reloadAndRest&&P.current.reloadAndRest()}}),(0,i.jsx)(a.Z,g()(g()({},S),{},{ghost:!0,actionRef:P,scroll:{x:"max-content"},rowKey:"ID",columns:[{key:"serviceName",title:t.FD.format("listServiceName"),render:function(E,x,X,W,Y){var Z,I=0;return x.Task&&x.Task.forEach(function(Te){Te.Status.State=="running"&&(I+=1)}),(0,i.jsxs)(D.Z,{children:[x.Task&&(0,i.jsx)(O.Z,{color:"success",bordered:!1,children:I}),(0,i.jsx)(L.Z.Link,{onClick:function(){var ee;(ee=se.current)===null||ee===void 0||ee.show(x)},children:(Z=x.Spec)===null||Z===void 0?void 0:Z.Name})]})}},{width:150,search:!1,title:t.FD.format("listPort"),render:function(E,x,X,W,Y){var Z,I,Te=[];return!((Z=x.Endpoint)===null||Z===void 0)&&Z.Ports&&((I=x.Endpoint)===null||I===void 0||I.Ports.map(function(ee){var ce,pe,c;Te.push({PrivatePort:(ce=ee.TargetPort)!==null&&ce!==void 0?ce:0,Type:(pe=ee.Protocol)!==null&&pe!==void 0?pe:"tcp",IP:"0.0.0.0",PublicPort:(c=ee.PublishedPort)!==null&&c!==void 0?c:0})})),(0,i.jsx)(j.Z,{ghost:!0,publicPort:Te,serverIp:we})}},{width:150,search:!1,title:t.FD.format("listServiceMode"),render:function(E,x,X,W,Y){return(0,i.jsx)(Ie,{detail:x})}},{hidden:!z.showImageName,width:400,search:!1,title:t.FD.format("listImageName"),render:function(E,x,X,W,Y){var Z,I=((Z=x.Spec)===null||Z===void 0||(Z=Z.TaskTemplate)===null||Z===void 0||(Z=Z.ContainerSpec)===null||Z===void 0?void 0:Z.Image)||"",Te=I.includes("@")?I.split("@"):[I,null],ee=H()(Te,2),ce=ee[0],pe=ee[1];return(0,i.jsx)(K.Z,{children:ce})}},{search:!1,width:180,title:t.FD.format("listCreatedAt"),render:function(E,x,X,W,Y){return(0,r.NF)(x.CreatedAt)}},{search:!1,width:180,title:t.FD.format("listUpdatedAt"),render:function(E,x,X,W,Y){return(0,r.NF)(x.UpdatedAt)}},{hidden:!z.showManage,search:!1,title:t.FD.format("listManage"),width:100,fixed:"right",render:function(E,x,X,W,Y){return(0,i.jsx)(D.Z,{split:(0,i.jsx)(y.Z,{type:"vertical"}),children:z.showManage&&z.showManage.onEdit&&(0,i.jsx)(L.Z.Link,{onClick:function(){var I;!((I=z.showManage)===null||I===void 0)&&I.onEdit&&z.showManage.onEdit(x)},children:(0,i.jsx)(ae.Z,{title:t.FD.format("listManageEdit"),children:(0,i.jsx)(s.Z,{})})},"edit")})}}],request:function(){var U=v()(o()().mark(function E(x){var X,W,Y;return o()().wrap(function(I){for(;;)switch(I.prev=I.next){case 0:if(!z.showWithNodeId){I.next=7;break}return I.next=3,(0,n.rN)({nodeId:(X=z.showWithNodeId)!==null&&X!==void 0?X:""});case 3:return W=I.sent,I.abrupt("return",{data:W.data.list,total:W.data.list.length,success:!0});case 7:return I.next=9,(0,n.kM)({name:x.serviceName});case 9:return Y=I.sent,I.abrupt("return",{data:Y.data.list,total:Y.data.list.length,success:!0});case 11:case"end":return I.stop()}},E)}));return function(E){return U.apply(this,arguments)}}(),expandable:z.showWithNodeId?{expandRowByClick:!0,rowExpandable:function(E){return E.Task&&E.Task.length>0&&E.Task.filter(function(x){return x.Status.State=="running"}).length>0},expandedRowRender:function(E){return(0,i.jsx)(re.Z,{rowKey:"ID",columns:[{title:t.FD.format("listName"),render:function(X,W,Y){return W.ID}},{width:120,title:t.FD.format("listRunStatus"),render:function(X,W,Y){var Z;return(0,i.jsx)(M.Z,{status:"task.".concat(W.Status.State),tip:(Z=W.Status.Err)!==null&&Z!==void 0?Z:W.Status.Message})}},{title:t.FD.format("listUpdatedAt"),width:180,render:function(X,W,Y){return(0,r.NF)(W.UpdatedAt)}},{width:100,title:t.FD.format("listManage"),fixed:"right",render:function(X,W,Y){var Z,I;return(0,i.jsx)(D.Z,{children:(0,i.jsx)(he,{type:"node",detail:{id:(Z=W.ID)!==null&&Z!==void 0?Z:"",name:(I=W.ID)!==null&&I!==void 0?I:""},trigger:(0,i.jsx)(L.Z.Link,{children:(0,i.jsx)(l.Z,{})})})})}}],pagination:!1,dataSource:E.Task.filter(function(x){return x.Status.State=="running"})})}}:void 0}))]})}),Ve=Ge},76428:function(le,F,e){"use strict";e.d(F,{Z:function(){return v}});var q=e(25593),o=e(67294),G=e(85893);function v(f){return(0,G.jsx)(q.Z.Text,{copyable:!0,children:f.title})}},12323:function(le,F,e){"use strict";e.d(F,{X:function(){return q},n:function(){return o}});var q={convertEol:!0,fontFamily:'Menlo, Monaco, "Courier New", monospace',fontWeight:400,fontSize:16,lineHeight:1,cursorStyle:"block",cursorInactiveStyle:"outline",cursorBlink:!0,letterSpacing:0,theme:{foreground:"#bfbfbf",cursor:"gray",selectionForeground:"#ffffff"}},o=["black","red","green","yellow","blue","magenta","cyan","white","brightBlack","brightRed","brightGreen","brightYellow","brightBlue","brightMagenta","brightCyan","brightWhite"]},24494:function(le,F,e){"use strict";e.d(F,{$m:function(){return g},HN:function(){return D},Id:function(){return h},JC:function(){return H},P3:function(){return ye},QB:function(){return j},UK:function(){return r},XX:function(){return K},Zc:function(){return L},ev:function(){return A},ig:function(){return je},kM:function(){return qe},kp:function(){return _},m8:function(){return s},rN:function(){return Ae},tm:function(){return Oe},vb:function(){return ae},x$:function(){return N}});var q=e(15009),o=e.n(q),G=e(99289),v=e.n(G),f=e(82346),g="com.dpanel.swarm.service.description",A="com.dpanel.swarm.service.registry";function H(){return n.apply(this,arguments)}function n(){return n=v()(o()().mark(function w(){return o()().wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.abrupt("return",(0,f.request)("/api/app/swarm/info",{method:"POST"}));case 1:case"end":return B.stop()}},w)})),n.apply(this,arguments)}function r(w){return t.apply(this,arguments)}function t(){return t=v()(o()().mark(function w(b){return o()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,f.request)("/api/app/swarm/init",{method:"POST",data:b}));case 1:case"end":return u.stop()}},w)})),t.apply(this,arguments)}function s(w){return l.apply(this,arguments)}function l(){return l=v()(o()().mark(function w(b){return o()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return b.id=String(b.id),u.abrupt("return",(0,f.request)("/api/app/swarm/log",{method:"POST",data:b}));case 2:case"end":return u.stop()}},w)})),l.apply(this,arguments)}function h(w){return a.apply(this,arguments)}function a(){return a=v()(o()().mark(function w(b){return o()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return b.download=!0,b.id=String(b.id),u.next=4,(0,f.request)("/api/app/swarm/log",{method:"POST",data:b,responseType:"blob"});case 4:return u.abrupt("return",u.sent);case 5:case"end":return u.stop()}},w)})),a.apply(this,arguments)}function D(w){return O.apply(this,arguments)}function O(){return O=v()(o()().mark(function w(b){return o()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,f.request)("/api/app/swarm/node-list",{method:"POST",data:b}));case 1:case"end":return u.stop()}},w)})),O.apply(this,arguments)}function L(w){return y.apply(this,arguments)}function y(){return y=v()(o()().mark(function w(b){return o()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,f.request)("/api/app/swarm/node-update",{method:"POST",data:b}));case 1:case"end":return u.stop()}},w)})),y.apply(this,arguments)}function ae(w){return re.apply(this,arguments)}function re(){return re=v()(o()().mark(function w(b){return o()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,f.request)("/api/app/swarm/info-join",{method:"POST",data:b}));case 1:case"end":return u.stop()}},w)})),re.apply(this,arguments)}function j(w){return M.apply(this,arguments)}function M(){return M=v()(o()().mark(function w(b){return o()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,f.request)("/api/app/swarm/node-remove",{method:"POST",data:b}));case 1:case"end":return u.stop()}},w)})),M.apply(this,arguments)}function _(w){return m.apply(this,arguments)}function m(){return m=v()(o()().mark(function w(b){return o()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,f.request)("/api/app/swarm/node-prune",{method:"POST",data:b}));case 1:case"end":return u.stop()}},w)})),m.apply(this,arguments)}function K(w){return ge.apply(this,arguments)}function ge(){return ge=v()(o()().mark(function w(b){return o()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,f.request)("/api/app/swarm/task-list",{method:"POST",data:b}));case 1:case"end":return u.stop()}},w)})),ge.apply(this,arguments)}function Ae(w){return p.apply(this,arguments)}function p(){return p=v()(o()().mark(function w(b){return o()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,f.request)("/api/app/swarm/task-list-in-node",{method:"POST",data:b}));case 1:case"end":return u.stop()}},w)})),p.apply(this,arguments)}function qe(w){return be.apply(this,arguments)}function be(){return be=v()(o()().mark(function w(b){return o()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,f.request)("/api/app/swarm/service-list",{method:"POST",data:b}));case 1:case"end":return u.stop()}},w)})),be.apply(this,arguments)}function N(w){return oe.apply(this,arguments)}function oe(){return oe=v()(o()().mark(function w(b){return o()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,f.request)("/api/app/swarm/service-scaling",{method:"POST",data:b}));case 1:case"end":return u.stop()}},w)})),oe.apply(this,arguments)}function Oe(w){return Se.apply(this,arguments)}function Se(){return Se=v()(o()().mark(function w(b){return o()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,f.request)("/api/app/swarm/service-delete",{method:"POST",data:b}));case 1:case"end":return u.stop()}},w)})),Se.apply(this,arguments)}function ye(w){return Ke.apply(this,arguments)}function Ke(){return Ke=v()(o()().mark(function w(b){return o()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,f.request)("/api/app/swarm/service-create",{method:"POST",data:b}));case 1:case"end":return u.stop()}},w)})),Ke.apply(this,arguments)}function je(w){return Ne.apply(this,arguments)}function Ne(){return Ne=v()(o()().mark(function w(b){return o()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.abrupt("return",(0,f.request)("/api/app/swarm/service-detail",{method:"POST",data:b}));case 1:case"end":return u.stop()}},w)})),Ne.apply(this,arguments)}},3393:function(le,F,e){"use strict";e.d(F,{Gb:function(){return H},Pn:function(){return s},Rb:function(){return h},YU:function(){return g},ZQ:function(){return L},_U:function(){return r},cD:function(){return ae},cd:function(){return D}});var q=e(15009),o=e.n(q),G=e(99289),v=e.n(G),f=e(82346);function g(j){return A.apply(this,arguments)}function A(){return A=v()(o()().mark(function j(M){return o()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.abrupt("return",(0,f.request)("/api/app/image/get-detail",{method:"POST",data:M}));case 1:case"end":return m.stop()}},j)})),A.apply(this,arguments)}function H(j){return n.apply(this,arguments)}function n(){return n=v()(o()().mark(function j(M){return o()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.abrupt("return",(0,f.request)("/api/app/image/tag-remote",{method:"POST",data:M}));case 1:case"end":return m.stop()}},j)})),n.apply(this,arguments)}function r(j){return t.apply(this,arguments)}function t(){return t=v()(o()().mark(function j(M){return o()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.abrupt("return",(0,f.request)("/api/app/image/tag-add",{method:"POST",data:M}));case 1:case"end":return m.stop()}},j)})),t.apply(this,arguments)}function s(j){return l.apply(this,arguments)}function l(){return l=v()(o()().mark(function j(M){return o()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.abrupt("return",(0,f.request)("/api/app/image/tag-delete",{method:"POST",data:M}));case 1:case"end":return m.stop()}},j)})),l.apply(this,arguments)}function h(j){return a.apply(this,arguments)}function a(){return a=v()(o()().mark(function j(M){return o()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.abrupt("return",(0,f.request)("/api/app/image/export",{method:"POST",data:M,responseType:"blob"}));case 1:case"end":return m.stop()}},j)})),a.apply(this,arguments)}function D(j){return O.apply(this,arguments)}function O(){return O=v()(o()().mark(function j(M){return o()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.abrupt("return",(0,f.request)("/api/pro/image/get-remote-tag",{method:"POST",data:M}));case 1:case"end":return m.stop()}},j)})),O.apply(this,arguments)}function L(j){return y.apply(this,arguments)}function y(){return y=v()(o()().mark(function j(M){return o()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.abrupt("return",(0,f.request)("/api/app/image/check-upgrade",{method:"POST",data:M}));case 1:case"end":return m.stop()}},j)})),y.apply(this,arguments)}function ae(j){return re.apply(this,arguments)}function re(){return re=v()(o()().mark(function j(M){return o()().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:return m.abrupt("return",(0,f.request)("/api/pro/image/get-rootfs",{method:"POST",data:M}));case 1:case"end":return m.stop()}},j)})),re.apply(this,arguments)}},67255:function(le,F,e){"use strict";e.d(F,{G$:function(){return f},LX:function(){return n},MJ:function(){return v},Oh:function(){return G},h5:function(){return A},j_:function(){return g},rj:function(){return H}});var q=e(5574),o=e.n(q);function G(r){var t=localStorage.getItem("dpanel-pagesize");return t=="all"?!1:{defaultCurrent:r==null?void 0:r.page,showSizeChanger:!0,defaultPageSize:parseInt(t!=null?t:"20"),showQuickJumper:!0}}function v(r,t){t?localStorage.setItem("dpanel-page-"+r,"".concat(t)):localStorage.removeItem("dpanel-page-"+r)}function f(r,t){var s=t?Math.ceil((t==null?void 0:t.total)/(t==null?void 0:t.pageSize)):void 0,l=localStorage.getItem("dpanel-page-"+r),h=1;return l&&(h=parseInt(l)),s&&h>s?1:h}function g(r){return{persistenceKey:r,persistenceType:"localStorage"}}var A=["descend","ascend"];function H(r,t){var s=localStorage.getItem("dpanel-table-sort-".concat(r));if(s){var l=s.split("|"),h=o()(l,2),a=h[0],D=h[1];if(a==t)return D}}function n(r,t,s){!t||!s?localStorage.removeItem("dpanel-table-sort-".concat(r)):localStorage.setItem("dpanel-table-sort-".concat(r),"".concat(t,"|").concat(s))}},75458:function(le){(function(F,e){le.exports=e()})(self,()=>(()=>{"use strict";var F={345:(G,v)=>{Object.defineProperty(v,"__esModule",{value:!0}),v.runAndSubscribe=v.forwardEvent=v.EventEmitter=void 0,v.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=f=>(this._listeners.push(f),{dispose:()=>{if(!this._disposed){for(let g=0;g<this._listeners.length;g++)if(this._listeners[g]===f)return void this._listeners.splice(g,1)}}})),this._event}fire(f,g){const A=[];for(let H=0;H<this._listeners.length;H++)A.push(this._listeners[H]);for(let H=0;H<A.length;H++)A[H].call(void 0,f,g)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},v.forwardEvent=function(f,g){return f(A=>g.fire(A))},v.runAndSubscribe=function(f,g){return g(void 0),f(A=>g(A))}},859:(G,v)=>{function f(g){for(const A of g)A.dispose();g.length=0}Object.defineProperty(v,"__esModule",{value:!0}),v.getDisposeArrayDisposable=v.disposeArray=v.toDisposable=v.MutableDisposable=v.Disposable=void 0,v.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(const g of this._disposables)g.dispose();this._disposables.length=0}register(g){return this._disposables.push(g),g}unregister(g){const A=this._disposables.indexOf(g);A!==-1&&this._disposables.splice(A,1)}},v.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(g){var A;this._isDisposed||g===this._value||((A=this._value)==null||A.dispose(),this._value=g)}clear(){this.value=void 0}dispose(){var g;this._isDisposed=!0,(g=this._value)==null||g.dispose(),this._value=void 0}},v.toDisposable=function(g){return{dispose:g}},v.disposeArray=f,v.getDisposeArrayDisposable=function(g){return{dispose:()=>f(g)}}}},e={};function q(G){var v=e[G];if(v!==void 0)return v.exports;var f=e[G]={exports:{}};return F[G](f,f.exports,q),f.exports}var o={};return(()=>{var G=o;Object.defineProperty(G,"__esModule",{value:!0}),G.SearchAddon=void 0;const v=q(345),f=q(859),g=" ~!@#$%^&*()+`-=[]{}|\\;:\"',./<>?";class A extends f.Disposable{constructor(n){var r;super(),this._highlightedLines=new Set,this._highlightDecorations=[],this._selectedDecoration=this.register(new f.MutableDisposable),this._linesCacheTimeoutId=0,this._linesCacheDisposables=new f.MutableDisposable,this._onDidChangeResults=this.register(new v.EventEmitter),this.onDidChangeResults=this._onDidChangeResults.event,this._highlightLimit=(r=n==null?void 0:n.highlightLimit)!=null?r:1e3}activate(n){this._terminal=n,this.register(this._terminal.onWriteParsed(()=>this._updateMatches())),this.register(this._terminal.onResize(()=>this._updateMatches())),this.register((0,f.toDisposable)(()=>this.clearDecorations()))}_updateMatches(){var n;this._highlightTimeout&&window.clearTimeout(this._highlightTimeout),this._cachedSearchTerm&&((n=this._lastSearchOptions)!=null&&n.decorations)&&(this._highlightTimeout=setTimeout(()=>{const r=this._cachedSearchTerm;this._cachedSearchTerm=void 0,this.findPrevious(r,ht(ct({},this._lastSearchOptions),{incremental:!0,noScroll:!0}))},200))}clearDecorations(n){this._selectedDecoration.clear(),(0,f.disposeArray)(this._highlightDecorations),this._highlightDecorations=[],this._highlightedLines.clear(),n||(this._cachedSearchTerm=void 0)}clearActiveDecoration(){this._selectedDecoration.clear()}findNext(n,r){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");const t=!this._lastSearchOptions||this._didOptionsChange(this._lastSearchOptions,r);this._lastSearchOptions=r,r!=null&&r.decorations&&(this._cachedSearchTerm===void 0||n!==this._cachedSearchTerm||t)&&this._highlightAllMatches(n,r);const s=this._findNextAndSelect(n,r);return this._fireResults(r),this._cachedSearchTerm=n,s}_highlightAllMatches(n,r){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!n||n.length===0)return void this.clearDecorations();r=r||{},this.clearDecorations(!0);const t=[];let s,l=this._find(n,0,0,r);for(;l&&((s==null?void 0:s.row)!==l.row||(s==null?void 0:s.col)!==l.col)&&!(t.length>=this._highlightLimit);)s=l,t.push(s),l=this._find(n,s.col+s.term.length>=this._terminal.cols?s.row+1:s.row,s.col+s.term.length>=this._terminal.cols?0:s.col+1,r);for(const h of t){const a=this._createResultDecoration(h,r.decorations);a&&(this._highlightedLines.add(a.marker.line),this._highlightDecorations.push({decoration:a,match:h,dispose(){a.dispose()}}))}}_find(n,r,t,s){var a;if(!this._terminal||!n||n.length===0)return(a=this._terminal)==null||a.clearSelection(),void this.clearDecorations();if(t>this._terminal.cols)throw new Error(`Invalid col: ${t} to search in terminal of ${this._terminal.cols} cols`);let l;this._initLinesCache();const h={startRow:r,startCol:t};if(l=this._findInLine(n,h,s),!l)for(let D=r+1;D<this._terminal.buffer.active.baseY+this._terminal.rows&&(h.startRow=D,h.startCol=0,l=this._findInLine(n,h,s),!l);D++);return l}_findNextAndSelect(n,r){var D;if(!this._terminal||!n||n.length===0)return(D=this._terminal)==null||D.clearSelection(),this.clearDecorations(),!1;const t=this._terminal.getSelectionPosition();this._terminal.clearSelection();let s=0,l=0;t&&(this._cachedSearchTerm===n?(s=t.end.x,l=t.end.y):(s=t.start.x,l=t.start.y)),this._initLinesCache();const h={startRow:l,startCol:s};let a=this._findInLine(n,h,r);if(!a)for(let O=l+1;O<this._terminal.buffer.active.baseY+this._terminal.rows&&(h.startRow=O,h.startCol=0,a=this._findInLine(n,h,r),!a);O++);if(!a&&l!==0)for(let O=0;O<l&&(h.startRow=O,h.startCol=0,a=this._findInLine(n,h,r),!a);O++);return!a&&t&&(h.startRow=t.start.y,h.startCol=0,a=this._findInLine(n,h,r)),this._selectResult(a,r==null?void 0:r.decorations,r==null?void 0:r.noScroll)}findPrevious(n,r){if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");const t=!this._lastSearchOptions||this._didOptionsChange(this._lastSearchOptions,r);this._lastSearchOptions=r,r!=null&&r.decorations&&(this._cachedSearchTerm===void 0||n!==this._cachedSearchTerm||t)&&this._highlightAllMatches(n,r);const s=this._findPreviousAndSelect(n,r);return this._fireResults(r),this._cachedSearchTerm=n,s}_didOptionsChange(n,r){return!!r&&(n.caseSensitive!==r.caseSensitive||n.regex!==r.regex||n.wholeWord!==r.wholeWord)}_fireResults(n){if(n!=null&&n.decorations){let r=-1;if(this._selectedDecoration.value){const t=this._selectedDecoration.value.match;for(let s=0;s<this._highlightDecorations.length;s++){const l=this._highlightDecorations[s].match;if(l.row===t.row&&l.col===t.col&&l.size===t.size){r=s;break}}}this._onDidChangeResults.fire({resultIndex:r,resultCount:this._highlightDecorations.length})}}_findPreviousAndSelect(n,r){var O;if(!this._terminal)throw new Error("Cannot use addon until it has been loaded");if(!this._terminal||!n||n.length===0)return(O=this._terminal)==null||O.clearSelection(),this.clearDecorations(),!1;const t=this._terminal.getSelectionPosition();this._terminal.clearSelection();let s=this._terminal.buffer.active.baseY+this._terminal.rows-1,l=this._terminal.cols;const h=!0;this._initLinesCache();const a={startRow:s,startCol:l};let D;if(t&&(a.startRow=s=t.start.y,a.startCol=l=t.start.x,this._cachedSearchTerm!==n&&(D=this._findInLine(n,a,r,!1),D||(a.startRow=s=t.end.y,a.startCol=l=t.end.x))),D||(D=this._findInLine(n,a,r,h)),!D){a.startCol=Math.max(a.startCol,this._terminal.cols);for(let L=s-1;L>=0&&(a.startRow=L,D=this._findInLine(n,a,r,h),!D);L--);}if(!D&&s!==this._terminal.buffer.active.baseY+this._terminal.rows-1)for(let L=this._terminal.buffer.active.baseY+this._terminal.rows-1;L>=s&&(a.startRow=L,D=this._findInLine(n,a,r,h),!D);L--);return this._selectResult(D,r==null?void 0:r.decorations,r==null?void 0:r.noScroll)}_initLinesCache(){const n=this._terminal;this._linesCache||(this._linesCache=new Array(n.buffer.active.length),this._linesCacheDisposables.value=(0,f.getDisposeArrayDisposable)([n.onLineFeed(()=>this._destroyLinesCache()),n.onCursorMove(()=>this._destroyLinesCache()),n.onResize(()=>this._destroyLinesCache())])),window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=window.setTimeout(()=>this._destroyLinesCache(),15e3)}_destroyLinesCache(){this._linesCache=void 0,this._linesCacheDisposables.clear(),this._linesCacheTimeoutId&&(window.clearTimeout(this._linesCacheTimeoutId),this._linesCacheTimeoutId=0)}_isWholeWord(n,r,t){return(n===0||g.includes(r[n-1]))&&(n+t.length===r.length||g.includes(r[n+t.length]))}_findInLine(n,r,t={},s=!1){var _;const l=this._terminal,h=r.startRow,a=r.startCol,D=l.buffer.active.getLine(h);if(D!=null&&D.isWrapped)return s?void(r.startCol+=l.cols):(r.startRow--,r.startCol+=l.cols,this._findInLine(n,r,t));let O=(_=this._linesCache)==null?void 0:_[h];O||(O=this._translateBufferLineToStringWithWrap(h,!0),this._linesCache&&(this._linesCache[h]=O));const[L,y]=O,ae=this._bufferColsToStringOffset(h,a),re=t.caseSensitive?n:n.toLowerCase(),j=t.caseSensitive?L:L.toLowerCase();let M=-1;if(t.regex){const m=RegExp(re,"g");let K;if(s)for(;K=m.exec(j.slice(0,ae));)M=m.lastIndex-K[0].length,n=K[0],m.lastIndex-=n.length-1;else K=m.exec(j.slice(ae)),K&&K[0].length>0&&(M=ae+(m.lastIndex-K[0].length),n=K[0])}else s?ae-re.length>=0&&(M=j.lastIndexOf(re,ae-re.length)):M=j.indexOf(re,ae);if(M>=0){if(t.wholeWord&&!this._isWholeWord(M,j,n))return;let m=0;for(;m<y.length-1&&M>=y[m+1];)m++;let K=m;for(;K<y.length-1&&M+n.length>=y[K+1];)K++;const ge=M-y[m],Ae=M+n.length-y[K],p=this._stringLengthToBufferSize(h+m,ge);return{term:n,col:p,row:h+m,size:this._stringLengthToBufferSize(h+K,Ae)-p+l.cols*(K-m)}}}_stringLengthToBufferSize(n,r){const t=this._terminal.buffer.active.getLine(n);if(!t)return 0;for(let s=0;s<r;s++){const l=t.getCell(s);if(!l)break;const h=l.getChars();h.length>1&&(r-=h.length-1);const a=t.getCell(s+1);a&&a.getWidth()===0&&r++}return r}_bufferColsToStringOffset(n,r){const t=this._terminal;let s=n,l=0,h=t.buffer.active.getLine(s);for(;r>0&&h;){for(let a=0;a<r&&a<t.cols;a++){const D=h.getCell(a);if(!D)break;D.getWidth()&&(l+=D.getCode()===0?1:D.getChars().length)}if(s++,h=t.buffer.active.getLine(s),h&&!h.isWrapped)break;r-=t.cols}return l}_translateBufferLineToStringWithWrap(n,r){var a;const t=this._terminal,s=[],l=[0];let h=t.buffer.active.getLine(n);for(;h;){const D=t.buffer.active.getLine(n+1),O=!!D&&D.isWrapped;let L=h.translateToString(!O&&r);if(O&&D){const y=h.getCell(h.length-1);y&&y.getCode()===0&&y.getWidth()===1&&((a=D.getCell(0))==null?void 0:a.getWidth())===2&&(L=L.slice(0,-1))}if(s.push(L),!O)break;l.push(l[l.length-1]+L.length),n++,h=D}return[s.join(""),l]}_selectResult(n,r,t){const s=this._terminal;if(this._selectedDecoration.clear(),!n)return s.clearSelection(),!1;if(s.select(n.col,n.row,n.size),r){const l=s.registerMarker(-s.buffer.active.baseY-s.buffer.active.cursorY+n.row);if(l){const h=s.registerDecoration({marker:l,x:n.col,width:n.size,backgroundColor:r.activeMatchBackground,layer:"top",overviewRulerOptions:{color:r.activeMatchColorOverviewRuler}});if(h){const a=[];a.push(l),a.push(h.onRender(D=>this._applyStyles(D,r.activeMatchBorder,!0))),a.push(h.onDispose(()=>(0,f.disposeArray)(a))),this._selectedDecoration.value={decoration:h,match:n,dispose(){h.dispose()}}}}}if(!t&&(n.row>=s.buffer.active.viewportY+s.rows||n.row<s.buffer.active.viewportY)){let l=n.row-s.buffer.active.viewportY;l-=Math.floor(s.rows/2),s.scrollLines(l)}return!0}_applyStyles(n,r,t){n.classList.contains("xterm-find-result-decoration")||(n.classList.add("xterm-find-result-decoration"),r&&(n.style.outline=`1px solid ${r}`)),t&&n.classList.add("xterm-find-active-result-decoration")}_createResultDecoration(n,r){const t=this._terminal,s=t.registerMarker(-t.buffer.active.baseY-t.buffer.active.cursorY+n.row);if(!s)return;const l=t.registerDecoration({marker:s,x:n.col,width:n.size,backgroundColor:r.matchBackground,overviewRulerOptions:this._highlightedLines.has(s.line)?void 0:{color:r.matchOverviewRuler,position:"center"}});if(l){const h=[];h.push(s),h.push(l.onRender(a=>this._applyStyles(a,r.matchBorder,!1))),h.push(l.onDispose(()=>(0,f.disposeArray)(h)))}return l}}G.SearchAddon=A})(),o})())}}]);
}());